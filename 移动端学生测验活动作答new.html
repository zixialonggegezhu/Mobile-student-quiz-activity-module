<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ™ºæ…§å­¦ä¹ å¹³å° - æµ‹éªŒå…¨åœºæ™¯ç‰ˆ</title>
    <style>
        /* =========================================
           PART 1: åŸºç¡€æ¶æ„ä¸é€šç”¨æ ·å¼
           ========================================= */
        :root {
            --primary: #00bfa5;
            --primary-light: #e0f2f1;
            --secondary: #5c6bc0;
            --task-blue: #2196f3;
            --bg-body: #f7f8fa;
            --bg-card: #ffffff;
            --text-main: #333333;
            --text-sub: #888888;
            --text-highlight: #ff6b6b;
            --nav-height: 60px;
            --radius-box: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif; background-color: var(--bg-body); color: var(--text-main); font-size: 14px; padding-bottom: calc(var(--nav-height) + 20px); height: 100vh; overflow: hidden; }
        
        ::-webkit-scrollbar { display: none; }
        
        /* é¡µé¢å®¹å™¨ç³»ç»Ÿ */
        .page { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; background: var(--bg-body); z-index: 10; overflow-y: auto; padding-bottom: 80px; }
        .page.active { display: block; animation: slideIn 0.3s ease; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

        .container { padding: 16px; }
        
        /* é€šç”¨å¯¼èˆªæ  */
        .detail-header { position: sticky; top: 0; background: #fff; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .nav-bar { height: 44px; display: flex; align-items: center; padding: 0 16px; font-size: 16px; font-weight: 600; }
        .back-btn { margin-right: 16px; font-size: 20px; color: #333; cursor: pointer; padding: 0 10px; }

        /* åº•éƒ¨å›ºå®šå¤§æŒ‰é’® */
        .fixed-bottom-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; background: #fff; z-index: 100;
            padding: 10px 16px calc(10px + var(--safe-bottom)); border-top: 1px solid #f0f0f0;
            display: flex; justify-content: center;
        }
        .btn-big-start { 
            width: 100%; background: var(--task-blue); color: #fff; font-size: 16px; font-weight: 600;
            height: 46px; border-radius: 23px; border: none; box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .btn-big-start:active { transform: scale(0.98); background: #1976d2; }

        /* =========================================
           PART 2: é¦–é¡µä¸è¯¾ç¨‹è¯¦æƒ…æ ·å¼
           ========================================= */
        /* æœç´¢æ  */
        .search-bar { background: #fff; padding: 10px 16px; position: sticky; top: 0; z-index: 99; box-shadow: 0 2px 10px rgba(0,0,0,0.03); display: flex; align-items: center; }
        .search-input-box { flex: 1; background: #f0f2f5; border-radius: 20px; height: 36px; display: flex; align-items: center; padding: 0 12px; color: #999; }
        .icon-scan { margin-left: 12px; width: 24px; height: 24px; background: #ddd; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 12px; color: #666; }

        /* è¯¾ç¨‹å¡ç‰‡ */
        .course-card { background: var(--bg-card); border-radius: var(--radius-box); box-shadow: var(--shadow); margin-bottom: 16px; overflow: hidden; position: relative; cursor: pointer; transition: transform 0.1s; }
        .course-card:active { transform: scale(0.98); }
        .card-cover { width: 100%; height: 140px; background-color: #000; position: relative; background-image: url('https://images.unsplash.com/photo-1620712943543-bcc4688e7485?q=80&w=800&auto=format&fit=crop'); background-size: cover; background-position: center; }
        .tag-ai { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .card-body { padding: 12px 16px; }
        .card-title { font-size: 16px; font-weight: 600; margin-bottom: 12px; line-height: 1.4; }
        .card-stats { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .badge-score { background: #fff3e0; color: #ff9800; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .progress-ring { position: relative; width: 50px; height: 50px; }
        .ring-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .ring-circle-bg { fill: none; stroke: #eee; stroke-width: 4; }
        .ring-circle-fg { fill: none; stroke: var(--primary); stroke-width: 4; stroke-dasharray: 126; stroke-dashoffset: 10; stroke-linecap: round; }
        .ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 14px; font-weight: bold; color: var(--primary); display: flex; flex-direction: column; align-items: center; line-height: 1; }
        .card-footer { border-top: 1px solid #f0f0f0; padding-top: 10px; display: flex; justify-content: space-between; align-items: center; }
        .task-alert strong { color: #ff4757; }
        .btn-go { background: linear-gradient(90deg, #26c6da, #00bfa5); color: #fff; padding: 6px 16px; border-radius: 16px; font-size: 12px; font-weight: 500; }

        /* è¯¾ç¨‹è¯¦æƒ… */
        .detail-cover { width: 100%; height: 180px; background-image: url('https://images.unsplash.com/photo-1555949963-aa79dcee981c?q=80&w=800&auto=format&fit=crop'); background-size: cover; display: flex; align-items: flex-end; padding: 16px; color: #fff; position: relative; flex-shrink: 0; }
        .detail-cover::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); }
        .detail-title-overlay { position: relative; z-index: 2; width: 100%; }
        .d-title { font-size: 20px; font-weight: bold; margin-bottom: 8px; }
        .tabs { display: flex; background: #fff; border-bottom: 1px solid #eee; position: sticky; top: 44px; z-index: 90;}
        .tab-item { flex: 1; text-align: center; padding: 14px 0; color: #666; font-size: 14px; position: relative; cursor: pointer; }
        .tab-item.active { color: var(--secondary); font-weight: 600; }
        .tab-item.active::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 20px; height: 3px; background: var(--secondary); border-radius: 3px; }
        .tab-content { padding: 16px; display: none; }
        .tab-content.active { display: block; }

        /* ç« èŠ‚æ´»åŠ¨åˆ—è¡¨ */
        .chapter-group { margin-bottom: 16px; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.02); }
        .chapter-header { padding: 16px; background: #fcfcfc; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f5f5f5; cursor: pointer; }
        .ch-title { font-weight: 600; font-size: 14px; color: #333; }
        .arrow { transition: transform 0.3s; color: #ccc; font-size: 12px; }
        .chapter-group.collapsed .arrow { transform: rotate(-90deg); }
        .chapter-group.collapsed .chapter-list { display: none; }
        .chapter-list { padding: 0 16px; }
        .activity-item { display: flex; align-items: center; padding: 16px 0; border-bottom: 1px solid #f5f5f5; cursor: pointer; }
        .activity-item:last-child { border-bottom: none; }
        .act-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 16px; flex-shrink: 0; }
        
        .bg-video { background: #e3f2fd; color: #2196f3; }
        .bg-doc { background: #f3e5f5; color: #ab47bc; }
        .bg-quiz { background: #ffebee; color: #ef5350; }
        .bg-discuss { background: #fff3e0; color: #ff9800; }
        .bg-sim { background: #e8eaf6; color: #3f51b5; }

        .act-content { flex: 1; }
        .act-title { font-size: 13px; font-weight: 500; margin-bottom: 4px; display: block; }
        .act-desc { font-size: 11px; color: #999; }
        .btn-learn-sm { padding: 4px 12px; border: 1px solid var(--primary); color: var(--primary); border-radius: 12px; font-size: 11px; background: #fff; }
        .btn-disabled { border-color: #ccc; color: #ccc; }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: var(--nav-height); background: #fff; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 998; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #999; font-size: 10px; gap: 4px; }
        .nav-item.active { color: var(--secondary); }
        .nav-icon { font-size: 20px; }

        /* =========================================
           PART 3: æµ‹éªŒæ´»åŠ¨æ ·å¼ (Quiz Styles)
           ========================================= */
        
        /* 1. æµ‹éªŒå°é¢é¡µ */
        .quiz-cover-container { padding: 20px 16px; padding-bottom: 80px; }
        .quiz-header-card { 
            background: #fff; border-radius: 12px; padding: 20px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); text-align: center; margin-bottom: 20px;
        }
        .quiz-icon-lg { 
            width: 60px; height: 60px; background: #ffebee; color: #ef5350; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 28px; margin: 0 auto 16px; 
        }
        .quiz-title-lg { font-size: 20px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .quiz-status-badge { 
            background: #e8f5e9; color: #4caf50; font-size: 12px; padding: 4px 10px; 
            border-radius: 4px; display: inline-block; 
        }
        
        .quiz-info-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; 
        }
        .quiz-info-item { 
            background: #fff; padding: 12px; border-radius: 8px; border: 1px solid #f0f0f0; 
            text-align: center; 
        }
        .q-info-val { font-size: 16px; font-weight: bold; color: #333; display: block; margin-bottom: 4px; }
        .q-info-label { font-size: 12px; color: #999; }
        
        .quiz-desc-box { 
            background: #fff; border-radius: 12px; padding: 16px; 
            font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 20px;
        }
        
        /* å†å²è®°å½•å¡ç‰‡ */
        .history-card {
            background: #fff; border-radius: 8px; border: 1px solid #eee; margin-top: 16px; overflow: hidden;
        }
        .history-card-header { padding: 12px 16px; font-weight: bold; background: #fafafa; border-bottom: 1px solid #eee; }
        .history-row {
            display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #f5f5f5;
        }
        .history-row:last-child { border-bottom: none; }
        .h-date { font-size: 13px; color: #666; }
        .h-score { font-weight: bold; color: #333; margin: 0 10px; }
        .btn-view-link { color: #2196f3; font-size: 12px; cursor: pointer; }

        /* 2. ç­”é¢˜é¡µ & å¤šé¢˜å‹æ ·å¼ */
        .quiz-top-bar { 
            height: 50px; background: #fff; display: flex; align-items: center; justify-content: space-between; 
            padding: 0 16px; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 90;
        }
        .quiz-timer { 
            font-family: monospace; font-size: 16px; font-weight: bold; color: #333; 
            display: flex; align-items: center; gap: 6px; 
        }
        .quiz-timer.warning { color: #f44336; animation: pulse 1s infinite; }
        .quiz-card-trigger { 
            display: flex; align-items: center; gap: 4px; font-size: 14px; color: #666; cursor: pointer;
        }

        .quiz-content-area { padding: 20px 16px 80px; }
        .q-score-tag {
            font-size: 12px; color: #666; background: #f0f0f0; padding: 2px 6px; border-radius: 4px; float: right;
        }
        .q-type-tag { 
            background: #e3f2fd; color: #2196f3; font-size: 11px; padding: 2px 6px; 
            border-radius: 4px; vertical-align: middle; margin-right: 6px; 
        }
        .q-stem { font-size: 16px; font-weight: 500; line-height: 1.5; color: #333; margin-bottom: 20px; }
        
        .q-options-list { display: flex; flex-direction: column; gap: 12px; }
        .q-option-item { 
            display: flex; gap: 12px; padding: 12px; border: 1px solid #e0e0e0; 
            border-radius: 8px; background: #fff; cursor: pointer; transition: all 0.2s;
        }
        .q-option-item:active { background: #f5f5f5; }
        .q-option-item.selected { border-color: #2196f3; background: #e3f2fd; }
        
        /* æ ·å¼çŠ¶æ€ï¼šè§£æé¡µç”¨ */
        .q-option-item.error { border-color: #ef5350; background: #ffebee; } 
        .q-option-item.correct { border-color: #4caf50; background: #e8f5e9; } 

        /* é€‰é¡¹å›¾æ ‡ï¼šå•é€‰åœ†å½¢ï¼Œå¤šé€‰æ–¹å½¢ */
        .opt-char { 
            width: 24px; height: 24px; border-radius: 50%; border: 1px solid #ccc; 
            display: flex; align-items: center; justify-content: center; font-size: 12px; 
            font-weight: bold; color: #666; flex-shrink: 0; margin-top: 2px;
        }
        .opt-char.square { border-radius: 4px; } /* å¤šé€‰æ ·å¼ */

        .q-option-item.selected .opt-char { background: #2196f3; color: #fff; border-color: #2196f3; }
        .q-option-item.error .opt-char { background: #ef5350; color: #fff; border-color: #ef5350; }
        .q-option-item.correct .opt-char { background: #4caf50; color: #fff; border-color: #4caf50; }
        
        .opt-text { flex: 1; font-size: 14px; color: #333; line-height: 1.4; }

        /* å¡«ç©ºä¸ç®€ç­”è¾“å…¥æ¡† */
        .q-input-area {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 14px; margin-top: 10px; outline: none; transition: border-color 0.2s;
        }
        .q-input-area:focus { border-color: #2196f3; }
        
        .q-essay-area {
            width: 100%; height: 120px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 14px; margin-top: 10px; resize: none; outline: none; transition: border-color 0.2s;
            font-family: inherit;
        }
        .q-essay-area:focus { border-color: #2196f3; }

        .quiz-nav-bottom { 
            position: fixed; bottom: 0; left: 0; right: 0; background: #fff; height: 60px; 
            border-top: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; 
            padding: 0 16px; z-index: 100; box-shadow: 0 -2px 10px rgba(0,0,0,0.02);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .btn-quiz-nav { 
            padding: 8px 20px; border-radius: 20px; font-size: 14px; font-weight: 500; cursor: pointer; 
        }
        .btn-prev { background: #f5f5f5; color: #666; border: 1px solid #e0e0e0; }
        .btn-next { background: #2196f3; color: #fff; border: none; }
        .btn-submit-quiz { background: #4caf50; color: #fff; border: none; }

        /* ç­”é¢˜å¡å¼¹çª— */
        .card-sheet-body { padding: 20px; max-height: 60vh; overflow-y: auto; }
        .card-grid-quiz { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-top: 10px; 
        }
        .card-num-item { 
            aspect-ratio: 1; border-radius: 50%; border: 1px solid #ddd; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 14px; color: #666; cursor: pointer;
        }
        .card-num-item.done { background: #e3f2fd; color: #2196f3; border-color: #2196f3; }
        .card-num-item.current { border: 2px solid #2196f3; color: #2196f3; font-weight: bold; }

        /* 3. ç»“æœé¡µ */
        .result-score-box { 
            background: #fff; padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .rs-circle { 
            width: 120px; height: 120px; border-radius: 50%; border: 6px solid #4caf50; 
            margin: 0 auto 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        .rs-score { font-size: 36px; font-weight: bold; color: #4caf50; line-height: 1; }
        .rs-total { font-size: 12px; color: #999; margin-top: 4px; }
        .rs-status { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 6px; }
        .rs-desc { font-size: 13px; color: #666; }
        /* å¾…è¯„é˜…çŠ¶æ€çš„ç‰¹æ®Šæ ·å¼ */
        .rs-circle.pending { border-color: #ff9800; }
        .rs-circle.pending .rs-score { color: #ff9800; }
        .rs-tip { display: block; font-size: 10px; color: #ff9800; margin-top: -4px; }

        .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
        .result-stat-item { background: #fff; padding: 16px; border-radius: 8px; text-align: center; border: 1px solid #f0f0f0; }
        .rsi-val { font-size: 18px; font-weight: bold; color: #333; }
        .rsi-label { font-size: 11px; color: #999; margin-top: 4px; }

        /* 4. è§£æé¡µ */
        .question-score-bar {
            background: #f5f5f5; padding: 8px 12px; border-radius: 6px; margin-bottom: 12px;
            display: flex; justify-content: space-between; font-size: 12px; color: #666;
        }
        .score-val.get { color: #4caf50; font-weight: bold; }
        .score-val.lost { color: #f44336; font-weight: bold; }
        .score-val.pending { color: #ff9800; font-weight: bold; }

        .analysis-box { 
            background: #fff3e0; border: 1px solid #ffe0b2; border-radius: 8px; padding: 16px; 
            margin-top: 20px; font-size: 13px; line-height: 1.6; color: #5d4037;
        }
        .ans-label { font-weight: bold; margin-bottom: 4px; display: block; }
        .ans-row { margin-bottom: 8px; }
        .ans-correct { color: #4caf50; font-weight: bold; }
        .ans-user { color: #f44336; font-weight: bold; }
        .user-text-answer { background: #f5f5f5; padding: 10px; border-radius: 6px; margin-bottom: 8px; color: #333; border-left: 3px solid #2196f3; }

        /* è°ƒè¯•å·¥å…·æ  */
        .debug-bar {
            position: fixed; top: 50px; right: 10px; z-index: 200;
            background: rgba(0,0,0,0.7); color: #fff; padding: 6px 12px; border-radius: 20px;
            font-size: 10px; cursor: pointer;
        }

        /* Modals */
        .reply-sheet-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 3000; display: none; align-items: flex-end; }
        .reply-sheet-overlay.show { display: flex; }
        .reply-sheet { width: 100%; background: #fff; border-radius: 16px 16px 0 0; padding: 16px; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); animation: slideUp 0.2s ease-out; display: flex; flex-direction: column; padding-bottom: calc(16px + env(safe-area-inset-bottom)); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <!-- é¡µé¢ 1: é¦–é¡µ-æˆ‘çš„è¯¾ç¨‹ -->
    <div id="page-home" class="page active">
        <div class="search-bar">
            <div class="search-input-box"><span style="margin-right:8px">ğŸ”</span> æœç´¢è¯¾ç¨‹...</div>
            <div class="icon-scan">ğŸ“·</div>
        </div>
        <div class="container">
            <!-- ç»™æ•´ä¸ªå¡ç‰‡åŠ äº†è·³è½¬ï¼Œä»¥é˜²ä¸‡ä¸€ -->
            <div class="course-card" onclick="navigateTo('page-detail')">
                <div class="card-cover"><div class="tag-ai">AI</div></div>
                <div class="card-body">
                    <div class="card-title">æ•°æ®ç»“æ„ä¸ç®—æ³•</div>
                    <div class="card-stats">
                        <div class="stats-left"><span class="badge-score">å­¦åˆ†: 4</span></div>
                        <div class="progress-ring">
                            <svg class="ring-svg"><circle class="ring-circle-bg" cx="25" cy="25" r="20"></circle><circle class="ring-circle-fg" cx="25" cy="25" r="20"></circle></svg>
                            <div class="ring-text">60<span style="font-size:8px">è¿›åº¦</span></div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="task-alert">å¾…å®Œæˆï¼š<strong>2</strong> ä¸ªä»»åŠ¡</div>
                        <!-- ä¿®å¤ç‚¹ï¼šæ·»åŠ  onclick äº‹ä»¶ -->
                        <div class="btn-go" onclick="navigateTo('page-detail'); event.stopPropagation();">å»å­¦ä¹  â†’</div>
                    </div>
                </div>
            </div>
        </div>
        <nav class="bottom-nav">
            <div class="nav-item active"><span class="nav-icon">ğŸ“š</span><span>è¯¾ç¨‹</span></div>
            <div class="nav-item"><span class="nav-icon">ğŸ“…</span><span>è¯¾è¡¨</span></div>
            <div class="nav-item"><span class="nav-icon">ğŸ””</span><span>æ¶ˆæ¯</span></div>
            <div class="nav-item"><span class="nav-icon">ğŸ‘¤</span><span>æˆ‘çš„</span></div>
        </nav>
    </div>

    <!-- é¡µé¢ 2: è¯¾ç¨‹è¯¦æƒ…é¡µ -->
    <div id="page-detail" class="page">
        <div class="detail-header">
            <div class="nav-bar">
                <div class="back-btn" onclick="navigateTo('page-home')">â†</div>
                <div style="flex:1; text-align:center;">æ•°æ®ç»“æ„ä¸ç®—æ³•</div>
            </div>
        </div>
        <div class="detail-cover">
            <div class="detail-title-overlay">
                <div class="d-title">æ•°æ®ç»“æ„ä¸ç®—æ³• (2025ç§‹)</div>
                <div style="display:flex; align-items:center; gap:10px; font-size:12px;">
                    <span>å·²å­¦ä¹  60%</span>
                    <div style="flex:1; background:rgba(255,255,255,0.3); height:4px; border-radius:2px;"><div style="width:60%; background:#00e676; height:100%; border-radius:2px;"></div></div>
                </div>
            </div>
        </div>
        <div class="tabs">
            <div class="tab-item active">ç« èŠ‚ç›®å½•</div>
            <div class="tab-item">è€ƒæ ¸æˆç»©</div>
        </div>
        <div class="tab-content active">
            <div class="chapter-group">
                <div class="chapter-header">
                    <div class="ch-title">ç¬¬ä¸€ç«  äººå·¥æ™ºèƒ½æ¦‚è¿°</div>
                    <span class="arrow">â–¼</span>
                </div>
                <div class="chapter-list">
                    <div class="activity-item">
                        <div class="act-icon bg-video">ğŸ“º</div>
                        <div class="act-content"><span class="act-title">1.1 é—®é¢˜æ±‚è§£çš„è®¡ç®—ä¹‹é“</span><span class="act-desc">è§†é¢‘ | 15åˆ†é’Ÿ</span></div>
                    </div>
                </div>
            </div>
            <div class="chapter-group">
                <div class="chapter-header">
                    <div class="ch-title">ç¬¬äºŒç«  çŠ¶æ€ç©ºé—´ä¸å®æˆ˜</div>
                    <span class="arrow">â–¼</span>
                </div>
                <div class="chapter-list">
                    <!-- æµ‹éªŒå…¥å£ (ä¿ç•™äº¤äº’) -->
                    <div class="activity-item">
                        <div class="act-icon bg-quiz">ğŸ“</div>
                        <div class="act-content"><span class="act-title">2.1 ç« èŠ‚å°æµ‹</span><span class="act-desc">æµ‹éªŒ | 10é“é¢˜ | é™æ—¶30åˆ†é’Ÿ</span></div>
                        <div class="act-status"><button class="btn-learn-sm" onclick="navigateTo('page-quiz-cover')">å»å®Œæˆ</button></div>
                    </div>
                    <!-- è®¨è®ºå…¥å£ (ç§»é™¤äº¤äº’) -->
                    <div class="activity-item" onclick="alert('è¯¥æ¨¡å—æš‚æœªå¼€æ”¾')">
                        <div class="act-icon bg-discuss">ğŸ’¬</div>
                        <div class="act-content"><span class="act-title">2.2 [è®¨è®º] AIä¼¦ç†è¾¹ç•Œ</span><span class="act-desc">è®¨è®º | éœ€å‘å¸–1æ¬¡</span></div>
                        <div class="act-status"><button class="btn-learn-sm btn-disabled">å»å‚ä¸</button></div>
                    </div>
                    <!-- æ¨¡æ‹Ÿå…¥å£ (ç§»é™¤äº¤äº’) -->
                    <div class="activity-item" onclick="alert('è¯¥æ¨¡å—æš‚æœªå¼€æ”¾')">
                        <div class="act-icon bg-sim">ğŸ­</div>
                        <div class="act-content"><span class="act-title">2.3 [æƒ…å¢ƒ] å®¢æˆ·æ²Ÿé€šå®æˆ˜</span><span class="act-desc">æƒ…å¢ƒæ¨¡æ‹Ÿ | æˆªæ­¢ 1-7</span></div>
                        <div class="act-status"><button class="btn-learn-sm btn-disabled">å¼€å§‹</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= PART 3: æµ‹éªŒæ´»åŠ¨é¡µé¢ ================= -->

    <!-- é¡µé¢ 3: æµ‹éªŒå°é¢é¡µ -->
    <div id="page-quiz-cover" class="page">
        <div class="detail-header">
            <div class="nav-bar">
                <div class="back-btn" onclick="navigateTo('page-detail')">â†</div>
                <div style="font-size:16px; font-weight:600;">ç« èŠ‚å°æµ‹</div>
            </div>
        </div>

        <div class="quiz-cover-container">
            <div class="quiz-header-card">
                <div class="quiz-icon-lg">ğŸ“</div>
                <div class="quiz-title-lg">2.1 ç« èŠ‚å°æµ‹</div>
                <div class="quiz-status-badge">è¿›è¡Œä¸­</div>
            </div>

            <div class="quiz-info-grid">
                <!-- ä¼˜åŒ–ï¼šæ·»åŠ é¢˜ç›®æ•°é‡ï¼Œç§»é™¤æƒé‡ -->
                <div class="quiz-info-item">
                    <span class="q-info-val">10é“</span>
                    <span class="q-info-label">é¢˜ç›®æ•°é‡</span>
                </div>
                <div class="quiz-info-item">
                    <span class="q-info-val">30åˆ†é’Ÿ</span>
                    <span class="q-info-label">ç­”é¢˜é™æ—¶</span>
                </div>
                <div class="quiz-info-item">
                    <span class="q-info-val">3æ¬¡</span>
                    <span class="q-info-label">å‰©ä½™æœºä¼š</span>
                </div>
                <div class="quiz-info-item">
                    <span class="q-info-val">60/100</span>
                    <span class="q-info-label">åŠæ ¼/æ€»åˆ†</span>
                </div>
            </div>

            <div class="desc-header" style="font-weight:bold; margin-bottom:10px; display:flex; align-items:center; gap:6px;">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                æµ‹éªŒè¯´æ˜
            </div>
            <div class="quiz-desc-box">
                æœ¬æ¬¡æµ‹éªŒä¸»è¦è€ƒå¯Ÿç¬¬äºŒç« å…³äºçŠ¶æ€ç©ºé—´æœç´¢ç­–ç•¥çš„ç†è§£ã€‚<br>
                1. åŒ…å«å•é€‰é¢˜ã€å¤šé€‰é¢˜ã€åˆ¤æ–­é¢˜ã€å¡«ç©ºé¢˜å’Œç®€ç­”é¢˜ã€‚<br>
                2. ç­”é¢˜è¿‡ç¨‹ä¸­åˆ‡å‹¿åˆ‡å‡ºå±å¹•è¶…è¿‡3æ¬¡ï¼Œå¦åˆ™å°†å¼ºåˆ¶äº¤å·ã€‚<br>
                3. ç³»ç»Ÿå–æœ€é«˜åˆ†ä½œä¸ºæœ€ç»ˆæˆç»©ã€‚
            </div>
            
            <!-- [ä¿®æ”¹] å†å²ä½œç­”è®°å½• -->
            <div class="history-card">
                <div class="history-card-header">å†å²ä½œç­”è®°å½•</div>
                <div class="history-row">
                    <div class="h-date">2024-12-20 14:00</div>
                    <div class="h-score">58åˆ† <span style="font-size:10px; color:#f44336; border:1px solid #f44336; padding:0 2px; border-radius:2px;">æœªé€šè¿‡</span></div>
                    <div class="btn-view-link" onclick="navigateTo('page-quiz-result')">æŸ¥çœ‹è¯¦æƒ…</div>
                </div>
            </div>
        </div>

        <div class="fixed-bottom-bar">
            <button class="btn-big-start" onclick="startQuiz()">å¼€å§‹æµ‹éªŒ</button>
        </div>
    </div>

    <!-- é¡µé¢ 4: ç­”é¢˜è¿›è¡Œä¸­ -->
    <div id="page-quiz-taking" class="page">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div class="quiz-top-bar">
            <div class="quiz-timer" id="quiz-countdown">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                29:45
            </div>
            <div class="quiz-card-trigger" onclick="showQuizCardSheet()">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M3 3h18v18H3z" fill="none"/><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM5 15h4v4H5zm0-6h4v4H5zm0-6h4v4H5zm6 12h4v4h-4zm0-6h4v4h-4zm0-6h4v4h-4zm6 12h4v4h-4zm0-6h4v4h-4zm0-6h4v4h-4z"/></svg>
                <span id="q-index-text">1/10</span>
            </div>
        </div>

        <div class="quiz-content-area" id="quiz-question-container">
            <!-- é¢˜ç›®å†…å®¹å°†é€šè¿‡ JS åŠ¨æ€æ¸²æŸ“ -->
        </div>

        <div class="quiz-nav-bottom">
            <button class="btn-quiz-nav btn-prev" onclick="prevQuestion()" disabled>ä¸Šä¸€é¢˜</button>
            <button class="btn-quiz-nav btn-submit-quiz" onclick="submitQuizConfirm()" style="display:none;">æäº¤è¯•å·</button>
            <button class="btn-quiz-nav btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
        </div>
    </div>

    <!-- é¡µé¢ 5: æµ‹éªŒç»“æœé¡µ (æ–°å¢åœºæ™¯åˆ‡æ¢) -->
    <div id="page-quiz-result" class="page">
        <!-- è°ƒè¯•å¼€å…³ -->
        <div class="debug-bar" onclick="toggleResultScene()">åˆ‡æ¢åœºæ™¯: å·²å‡ºåˆ† / å¾…è¯„é˜…</div>

        <div class="detail-header">
            <div class="nav-bar">
                <div class="back-btn" onclick="navigateTo('page-quiz-cover')">â†</div>
                <div style="font-size:16px; font-weight:600;">æµ‹éªŒç»“æœ</div>
            </div>
        </div>

        <div class="container">
            <div class="result-score-box">
                <!-- åœºæ™¯1ï¼šå·²å‡ºåˆ† -->
                <div id="scene-scored" style="display:block;">
                    <div class="rs-circle">
                        <div class="rs-score">78</div>
                        <div class="rs-total">/ 100åˆ†</div>
                    </div>
                    <div class="rs-status">æ­å–œé€šè¿‡ï¼</div>
                    <div class="rs-desc">å‡»è´¥äº†å…¨ç­ 65% çš„åŒå­¦ï¼Œç»§ç»­åŠ æ²¹ï¼</div>
                </div>
                
                <!-- åœºæ™¯2ï¼šå¾…è¯„é˜… -->
                <div id="scene-pending" style="display:none;">
                    <div class="rs-circle pending">
                        <div class="rs-score">58 <span style="font-size:14px;">+ ?</span></div>
                        <span class="rs-tip">å«æœªè¯„é˜…</span>
                    </div>
                    <div class="rs-status" style="color:#ff9800">æš‚æœªå‡ºåˆ†</div>
                    <div class="rs-desc">å®¢è§‚é¢˜å¾—åˆ† 58 åˆ†ï¼Œä¸»è§‚é¢˜ç­‰å¾…æ•™å¸ˆè¯„é˜…</div>
                </div>
            </div>

            <div class="result-grid">
                <div class="result-stat-item">
                    <div class="rsi-val" style="color:#4caf50;">8</div>
                    <div class="rsi-label">ç­”å¯¹é¢˜æ•°</div>
                </div>
                <div class="result-stat-item">
                    <div class="rsi-val" style="color:#f44336;">2</div>
                    <div class="rsi-label">ç­”é”™é¢˜æ•°</div>
                </div>
                <!-- ä¼˜åŒ–ï¼šå¢åŠ å¾…è¯„é˜…é¢˜æ•° -->
                <div class="result-stat-item">
                    <div class="rsi-val" id="pending-count-val">0</div>
                    <div class="rsi-label">å¾…è¯„é˜…é¢˜æ•°</div>
                </div>
                <div class="result-stat-item">
                    <div class="rsi-val">15:20</div>
                    <div class="rsi-label">ç”¨æ—¶</div>
                </div>
            </div>

            <button class="btn-big-start" style="margin-bottom:16px; background:#fff; color:#2196f3; border:1px solid #2196f3;" onclick="startAnalysis()">
                æŸ¥çœ‹è§£æ <span style="font-size:10px;">(æ¨¡æ‹Ÿï¼šæŒ‰è§„åˆ™æ˜¾ç¤º)</span>
            </button>
            <button class="btn-big-start" onclick="navigateTo('page-quiz-cover')">å†æ¬¡æµ‹éªŒ</button>
        </div>
    </div>

    <!-- é¡µé¢ 6: æµ‹éªŒè§£æé¡µ -->
    <div id="page-quiz-analysis" class="page">
        <div class="quiz-top-bar">
            <div class="back-btn" onclick="navigateTo('page-quiz-result')">â†</div>
            <div style="font-size:16px; font-weight:600;">é¢˜ç›®è§£æ</div>
            <div class="quiz-card-trigger" onclick="showQuizCardSheet()">
                <span id="qa-index-text">1/10</span>
            </div>
        </div>

        <div class="quiz-content-area" id="quiz-analysis-container">
            <!-- è§£æå†…å®¹é€šè¿‡ JS åŠ¨æ€æ¸²æŸ“ -->
        </div>
        
        <div class="quiz-nav-bottom">
            <button class="btn-quiz-nav btn-prev" onclick="prevQuestion()" disabled>ä¸Šä¸€é¢˜</button>
            <div style="flex:1"></div>
            <button class="btn-quiz-nav btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
        </div>
    </div>

    <!-- ç­”é¢˜å¡å¼¹çª— (Bottom Sheet) -->
    <div class="reply-sheet-overlay" id="quiz-card-overlay" onclick="hideQuizCardSheet(event)">
        <div class="reply-sheet" onclick="event.stopPropagation()">
            <div class="detail-header" style="border-radius:16px 16px 0 0;">
                <div class="nav-bar" style="border-bottom:1px solid #eee;">
                    <div style="font-size:16px; font-weight:600;">ç­”é¢˜å¡</div>
                    <div style="margin-left:auto; color:#2196f3; font-size:14px;" onclick="hideQuizCardSheet(null)">å…³é—­</div>
                </div>
            </div>
            <div class="card-sheet-body">
                <div style="display:flex; gap:16px; font-size:12px; margin-bottom:10px;">
                    <div style="display:flex; align-items:center; gap:4px;"><div style="width:12px; height:12px; background:#e3f2fd; border:1px solid #2196f3; border-radius:50%;"></div> å·²åš</div>
                    <div style="display:flex; align-items:center; gap:4px;"><div style="width:12px; height:12px; background:#fff; border:1px solid #ddd; border-radius:50%;"></div> æœªåš</div>
                    <div style="display:flex; align-items:center; gap:4px;"><div style="width:12px; height:12px; background:#fff; border:2px solid #2196f3; border-radius:50%;"></div> å½“å‰</div>
                </div>
                <div class="card-grid-quiz" id="card-grid-content">
                    <!-- JS ç”Ÿæˆ -->
                </div>
            </div>
            <div class="fixed-bottom-bar" style="position:static; border-top:1px solid #eee; margin-top:10px;">
                <button class="btn-big-start" style="background:#4caf50;" onclick="submitQuizConfirm()">äº¤å·</button>
            </div>
        </div>
    </div>

    <script>
        // é€šç”¨å¯¼èˆª
        function navigateTo(targetId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const target = document.getElementById(targetId);
            if(target) {
                target.classList.add('active');
                window.scrollTo(0,0);
            }
        }

        // =========================================
        // æµ‹éªŒæ•°æ®ä¸é€»è¾‘æ ¸å¿ƒä»£ç 
        // =========================================
        let currentQuestionIndex = 1;
        let isAnalysisMode = false; // åŒºåˆ†ç­”é¢˜æ¨¡å¼è¿˜æ˜¯è§£ææ¨¡å¼
        let quizTimerInterval;
        let isPendingScene = false; // é»˜è®¤å·²å‡ºåˆ†åœºæ™¯

        // æ¨¡æ‹Ÿè¯•é¢˜æ•°æ® (å«åˆ†å€¼) - ã€ä¿®å¤ã€‘ï¼šé»˜è®¤userAnså·²æ¸…ç©ºï¼Œç¡®ä¿åˆå§‹åŒ–æ—¶æ˜¯æœªåšçŠ¶æ€
        const quizQuestions = [
            { id: 1, type: 'single', score: 5, stem: 'ä»¥ä¸‹å“ªä¸ªæ•°æ®ç»“æ„éµå¾ªâ€œåè¿›å…ˆå‡ºâ€ï¼ˆLIFOï¼‰åŸåˆ™ï¼Ÿ', options: ['A. é˜Ÿåˆ—', 'B. æ ˆ', 'C. é“¾è¡¨', 'D. äºŒå‰æ ‘'], answer: 'B', userAns: '', analysis: 'æ ˆï¼ˆStackï¼‰æ˜¯åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ã€‚' },
            { id: 2, type: 'single', score: 5, stem: 'åœ¨æœ€å¥½æƒ…å†µä¸‹ï¼Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ï¼Ÿ', options: ['A. O(1)', 'B. O(n)', 'C. O(n^2)', 'D. O(log n)'], answer: 'B', userAns: '', analysis: 'å½“æ•°ç»„å·²ç»æœ‰åºæ—¶ï¼Œå†’æ³¡æ’åºåªéœ€ä¸€æ¬¡éå†ï¼Œå¤æ‚åº¦ä¸º O(n)ã€‚' },
            { id: 3, type: 'judge', score: 5, stem: 'äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†åºåˆ—ä¸€å®šæ˜¯å‡åºçš„ã€‚', options: ['A. æ­£ç¡®', 'B. é”™è¯¯'], answer: 'A', userAns: '', analysis: 'äºŒå‰æœç´¢æ ‘çš„æ€§è´¨å†³å®šäº†å…¶ä¸­åºéå†ç»“æœæ˜¯æœ‰åºçš„ã€‚' },
            { id: 4, type: 'judge', score: 5, stem: 'å¿«é€Ÿæ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºç®—æ³•ã€‚', options: ['A. æ­£ç¡®', 'B. é”™è¯¯'], answer: 'B', userAns: '', analysis: 'å¿«é€Ÿæ’åºåœ¨åˆ†åŒºè¿‡ç¨‹ä¸­å¯èƒ½æ”¹å˜ç›¸åŒå…ƒç´ çš„åŸæœ‰ç›¸å¯¹ä½ç½®ã€‚' },
            { id: 5, type: 'multi', score: 10, stem: 'ä»¥ä¸‹å“ªäº›æ˜¯å¸¸è§çš„å›¾éå†ç®—æ³•ï¼Ÿï¼ˆå¤šé€‰ï¼‰', options: ['A. æ·±åº¦ä¼˜å…ˆæœç´¢ (DFS)', 'B. å¹¿åº¦ä¼˜å…ˆæœç´¢ (BFS)', 'C. äºŒåˆ†æŸ¥æ‰¾', 'D. Dijkstra ç®—æ³•'], answer: ['A', 'B', 'D'], userAns: [], analysis: 'äºŒåˆ†æŸ¥æ‰¾ç”¨äºæ•°ç»„ï¼Œå…¶ä»–å‡åŸºäºå›¾éå†ã€‚' },
            { id: 6, type: 'multi', score: 10, stem: 'é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸‰å¤§ç‰¹æ€§åŒ…æ‹¬ï¼Ÿï¼ˆå¤šé€‰ï¼‰', options: ['A. å°è£…', 'B. ç»§æ‰¿', 'C. å¤šæ€', 'D. å¹¶å‘'], answer: ['A', 'B', 'C'], userAns: [], analysis: 'é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚' },
            { id: 7, type: 'fill', score: 10, stem: 'æ•°æ®ç»“æ„ä¸­ï¼Œé€šè¿‡______å‡½æ•°å°†é”®æ˜ å°„åˆ°è¡¨ä¸­çš„ä½ç½®çš„æŠ€æœ¯ç§°ä¸ºå“ˆå¸Œã€‚', answer: 'æ•£åˆ—', userAns: '', analysis: 'å“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼‰æˆ–æ•£åˆ—å‡½æ•°ã€‚' },
            { id: 8, type: 'fill', score: 10, stem: 'åœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œè‹¥èŠ‚ç‚¹ç¼–å·ä¸º iï¼Œåˆ™å…¶å·¦å­èŠ‚ç‚¹çš„ç¼–å·ä¸º______ã€‚', answer: '2i', userAns: '', analysis: 'å®Œå…¨äºŒå‰æ ‘æ€§è´¨ï¼šå·¦å­©å­ 2iï¼Œå³å­©å­ 2i+1ã€‚' },
            { id: 9, type: 'essay', score: 20, stem: 'ç®€è¿°â€œæ­»é”â€äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ã€‚', answer: 'äº’æ–¥ã€å æœ‰ä¸”ç­‰å¾…ã€ä¸å¯æŠ¢å ã€å¾ªç¯ç­‰å¾…', userAns: '', analysis: 'å››ä¸ªæ¡ä»¶ç¼ºä¸€ä¸å¯ï¼š1.äº’æ–¥æ¡ä»¶ï¼›2.è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼›3.ä¸å‰¥å¤ºæ¡ä»¶ï¼›4.å¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚' },
            { id: 10, type: 'essay', score: 20, stem: 'è¯·è§£é‡Šæ—¶é—´å¤æ‚åº¦ O(n) çš„å«ä¹‰ã€‚', answer: 'çº¿æ€§å…³ç³»', userAns: '', analysis: 'è¡¨ç¤ºç®—æ³•çš„æ‰§è¡Œæ—¶é—´ä¸è¾“å…¥è§„æ¨¡ n æˆçº¿æ€§æ¯”ä¾‹å¢é•¿å…³ç³»ã€‚' }
        ];

        function startQuiz() {
            isAnalysisMode = false;
            // ã€ä¿®å¤ã€‘ï¼šå¼ºåˆ¶é‡ç½®æ‰€æœ‰é¢˜ç›®çš„ç”¨æˆ·ç­”æ¡ˆï¼Œç¡®ä¿æ¯æ¬¡è¿›å…¥éƒ½æ˜¯æ–°çš„å¼€å§‹
            quizQuestions.forEach(q => {
                if (q.type === 'multi') {
                    q.userAns = [];
                } else {
                    q.userAns = '';
                }
            });
            navigateTo('page-quiz-taking');
            startQuizTimer();
            currentQuestionIndex = 1;
            renderQuestion(currentQuestionIndex);
            updateQuizUI();
            initCardGrid(); 
        }

        function startAnalysis() {
            isAnalysisMode = true;
            navigateTo('page-quiz-analysis');
            currentQuestionIndex = 1;
            renderQuestion(currentQuestionIndex);
            updateQuizUI();
            initCardGrid();
        }

        function renderQuestion(index) {
            const q = quizQuestions[index - 1];
            const container = isAnalysisMode ? document.getElementById('quiz-analysis-container') : document.getElementById('quiz-question-container');
            
            let typeLabel = '';
            switch(q.type) {
                case 'single': typeLabel = 'å•é€‰'; break;
                case 'multi': typeLabel = 'å¤šé€‰'; break;
                case 'judge': typeLabel = 'åˆ¤æ–­'; break;
                case 'fill': typeLabel = 'å¡«ç©º'; break;
                case 'essay': typeLabel = 'ç®€ç­”'; break;
            }

            let html = '';

            // [æ–°å¢] è§£æé¡µæ˜¾ç¤ºåˆ†å€¼çŠ¶æ€
            if (isAnalysisMode) {
                let scoreText = '';
                let scoreClass = '';
                
                // æ¨¡æ‹Ÿåˆ¤åˆ†é€»è¾‘
                const isSubjective = (q.type === 'fill' || q.type === 'essay');
                
                if (isSubjective && isPendingScene) {
                    scoreText = 'å¾—åˆ†ï¼šå¾…è¯„é˜…';
                    scoreClass = 'pending';
                } else {
                    // ç®€å•æ¨¡æ‹Ÿå®¢è§‚é¢˜åˆ¤åˆ†
                    let isCorrect = false;
                    if (Array.isArray(q.answer)) {
                        isCorrect = JSON.stringify(q.answer.sort()) === JSON.stringify(q.userAns.sort());
                    } else {
                        isCorrect = q.answer === q.userAns;
                    }
                    // ä¸»è§‚é¢˜åœ¨épendingæ¨¡å¼ä¸‹æ¨¡æ‹Ÿç»™ä¸ªåˆ†
                    if (isSubjective) isCorrect = (q.id === 8); // å‡å®šç¬¬8é¢˜å¯¹ï¼Œå…¶ä»–é”™

                    scoreText = isCorrect ? `å¾—åˆ†ï¼š${q.score} åˆ†` : `å¾—åˆ†ï¼š0 åˆ†`;
                    scoreClass = isCorrect ? 'get' : 'lost';
                }

                html += `
                    <div class="question-score-bar">
                        <span>æœ¬é¢˜ ${q.score} åˆ†</span>
                        <span class="score-val ${scoreClass}">${scoreText}</span>
                    </div>
                `;
            }

            html += `
                <div class="question-card-wrapper">
                    <div class="q-stem">
                        <span class="q-type-tag">${typeLabel}</span>
                        ${isAnalysisMode ? '' : `<span class="q-score-tag">${q.score}åˆ†</span>`}
                        ${q.stem}
                    </div>
            `;

            // æ¸²æŸ“é€‰é¡¹æˆ–è¾“å…¥æ¡†
            if (!isAnalysisMode) {
                // === ç­”é¢˜æ¨¡å¼ ===
                if (q.type === 'single' || q.type === 'judge') {
                    html += `<div class="q-options-list">`;
                    q.options.forEach((opt, idx) => {
                        const char = opt.substring(0, 1);
                        const isSelected = q.userAns === char ? 'selected' : '';
                        html += `
                            <div class="q-option-item ${isSelected}" onclick="selectSingle('${char}')">
                                <div class="opt-char">${char}</div>
                                <div class="opt-text">${opt.substring(2)}</div>
                            </div>
                        `;
                    });
                    html += `</div>`;
                } else if (q.type === 'multi') {
                    html += `<div class="q-options-list">`;
                    q.options.forEach((opt, idx) => {
                        const char = opt.substring(0, 1);
                        const isSelected = q.userAns.includes(char) ? 'selected' : '';
                        html += `
                            <div class="q-option-item ${isSelected}" onclick="selectMulti('${char}', this)">
                                <div class="opt-char square">${char}</div>
                                <div class="opt-text">${opt.substring(2)}</div>
                            </div>
                        `;
                    });
                    html += `</div>`;
                } else if (q.type === 'fill') {
                    html += `<input type="text" class="q-input-area" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" value="${q.userAns}" oninput="inputAnswer(this.value)">`;
                } else if (q.type === 'essay') {
                    html += `<textarea class="q-essay-area" placeholder="è¯·è¾“å…¥ä½ çš„å›ç­”..." oninput="inputAnswer(this.value)">${q.userAns}</textarea>`;
                }
            } else {
                // === è§£ææ¨¡å¼ ===
                if (q.type === 'single' || q.type === 'judge' || q.type === 'multi') {
                    html += `<div class="q-options-list">`;
                    q.options.forEach((opt, idx) => {
                        const char = opt.substring(0, 1);
                        let cls = '';
                        // åˆ¤æ–­æ­£ç¡®ä¸é”™è¯¯é«˜äº®
                        const isUserSel = Array.isArray(q.userAns) ? q.userAns.includes(char) : q.userAns === char;
                        const isCorrect = Array.isArray(q.answer) ? q.answer.includes(char) : q.answer === char;
                        
                        if (isCorrect) cls = 'correct';
                        else if (isUserSel && !isCorrect) cls = 'error';
                        else if (isUserSel) cls = 'selected'; 

                        html += `
                            <div class="q-option-item ${cls}">
                                <div class="opt-char ${q.type==='multi'?'square':''}">${char}</div>
                                <div class="opt-text">${opt.substring(2)}</div>
                            </div>
                        `;
                    });
                    html += `</div>`;
                } else {
                    html += `<div class="user-text-answer"><strong>ä½ çš„ä½œç­”ï¼š</strong>${q.userAns || 'æœªä½œç­”'}</div>`;
                }

                // è§£ææ¡†
                html += `
                    <div class="analysis-box">
                        <div class="ans-row"><span class="ans-label">æ­£ç¡®ç­”æ¡ˆï¼š</span><span class="ans-correct">${Array.isArray(q.answer) ? q.answer.join('ã€') : q.answer}</span></div>
                        <div class="ans-row" style="margin-top:10px;">
                            <span class="ans-label">é¢˜ç›®è§£æï¼š</span>
                            ${q.analysis}
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
            container.innerHTML = html;
        }

        // --- åœºæ™¯åˆ‡æ¢é€»è¾‘ ---
        function toggleResultScene() {
            isPendingScene = !isPendingScene;
            const sceneScored = document.getElementById('scene-scored');
            const scenePending = document.getElementById('scene-pending');
            const pendingCountEl = document.getElementById('pending-count-val');

            if (isPendingScene) {
                sceneScored.style.display = 'none';
                scenePending.style.display = 'block';
                pendingCountEl.innerText = '2'; // æ¨¡æ‹Ÿ2é“å¾…è¯„é˜…
            } else {
                sceneScored.style.display = 'block';
                scenePending.style.display = 'none';
                pendingCountEl.innerText = '0';
            }
        }

        // --- ç­”é¢˜äº¤äº’é€»è¾‘ ---
        function selectSingle(val) {
            if (isAnalysisMode) return;
            const q = quizQuestions[currentQuestionIndex - 1];
            q.userAns = val;
            renderQuestion(currentQuestionIndex);
            markCardDone(currentQuestionIndex);
        }

        function selectMulti(val, el) {
            if (isAnalysisMode) return;
            const q = quizQuestions[currentQuestionIndex - 1];
            
            // åˆå§‹åŒ–æ•°ç»„ï¼ˆé˜²æ­¢ undefinedï¼‰
            if (!Array.isArray(q.userAns)) q.userAns = [];

            const idx = q.userAns.indexOf(val);
            if (idx > -1) q.userAns.splice(idx, 1);
            else q.userAns.push(val);
            
            q.userAns.sort();
            
            // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°è§†å›¾
            renderQuestion(currentQuestionIndex);
            
            if (q.userAns.length > 0) markCardDone(currentQuestionIndex);
        }

        function inputAnswer(val) {
            if (isAnalysisMode) return;
            const q = quizQuestions[currentQuestionIndex - 1];
            q.userAns = val;
            if (val.trim().length > 0) markCardDone(currentQuestionIndex);
        }

        // --- é€šç”¨é€»è¾‘ ---
        function startQuizTimer() {
            let timeLeft = 30 * 60; 
            const timerEl = document.getElementById('quiz-countdown');
            if(quizTimerInterval) clearInterval(quizTimerInterval);
            quizTimerInterval = setInterval(() => {
                if(timeLeft <= 0) {
                    clearInterval(quizTimerInterval);
                    alert('æ—¶é—´åˆ°ï¼Œè‡ªåŠ¨äº¤å·ï¼');
                    navigateTo('page-quiz-result');
                    return;
                }
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                timerEl.innerText = `${m}:${s}`;
                if(timeLeft < 60) timerEl.classList.add('warning');
            }, 1000);
        }

        function updateQuizUI() {
            const pageId = isAnalysisMode ? 'page-quiz-analysis' : 'page-quiz-taking';
            const indexTextId = isAnalysisMode ? 'qa-index-text' : 'q-index-text';
            
            document.getElementById(indexTextId).innerText = `${currentQuestionIndex}/${quizQuestions.length}`;
            
            const prevBtn = document.querySelector(`#${pageId} .btn-prev`);
            const nextBtn = document.querySelector(`#${pageId} .btn-next`);
            
            const submitBtn = !isAnalysisMode ? document.querySelector(`#${pageId} .btn-submit-quiz`) : null;

            prevBtn.disabled = currentQuestionIndex === 1;
            
            if(currentQuestionIndex === quizQuestions.length) {
                nextBtn.style.display = 'none';
                if(submitBtn) submitBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                if(submitBtn) submitBtn.style.display = 'none';
            }
            
            document.querySelectorAll('.card-num-item').forEach((el, idx) => {
                if(idx + 1 === currentQuestionIndex) el.classList.add('current');
                else el.classList.remove('current');
            });
        }

        function nextQuestion() {
            if(currentQuestionIndex < quizQuestions.length) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
                updateQuizUI();
            }
        }

        function prevQuestion() {
            if(currentQuestionIndex > 1) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
                updateQuizUI();
            }
        }

        function initCardGrid() {
            const container = document.getElementById('card-grid-content');
            if (!container) return;
            
            let html = '';
            quizQuestions.forEach((q, index) => {
                let cls = 'card-num-item';
                let isDone = false;
                if (Array.isArray(q.userAns)) {
                    if (q.userAns.length > 0) isDone = true;
                } else {
                    if (q.userAns && q.userAns.trim() !== '') isDone = true;
                }
                if (isDone) cls += ' done';
                if (index + 1 === currentQuestionIndex) cls += ' current';
                html += `<div class="${cls}" onclick="jumpToQuestion(${index + 1})">${index + 1}</div>`;
            });
            container.innerHTML = html;
        }

        function markCardDone(idx) {
            // å®æ—¶æ›´æ–°é€»è¾‘ç•¥
        }

        function showQuizCardSheet() {
            initCardGrid(); 
            document.getElementById('quiz-card-overlay').classList.add('show');
        }

        function hideQuizCardSheet(e) {
            if (e) e.stopPropagation();
            document.getElementById('quiz-card-overlay').classList.remove('show');
        }

        function jumpToQuestion(index) {
            currentQuestionIndex = index;
            renderQuestion(currentQuestionIndex);
            updateQuizUI();
            hideQuizCardSheet(null);
        }

        function submitQuizConfirm() {
            let undone = 0;
            quizQuestions.forEach(q => {
                if (Array.isArray(q.userAns)) {
                    if (q.userAns.length === 0) undone++;
                } else if (!q.userAns) {
                    undone++;
                }
            });

            let msg = `ç¡®è®¤äº¤å·å—ï¼Ÿ`;
            if(undone > 0) msg = `æ‚¨è¿˜æœ‰ ${undone} é“é¢˜æœªå®Œæˆï¼Œ${msg}`;
            if(confirm(msg)) {
                clearInterval(quizTimerInterval);
                navigateTo('page-quiz-result');
                hideQuizCardSheet(null);
            }
        }
    </script>
</body>
</html>